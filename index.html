<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Регистрация участников</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 420px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .logo {
      text-align: center;
      margin-bottom: 15px;
    }
    .logo img {
      max-width: 160px;
      width: 100%;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 5px;
      margin-top: 15px;
      cursor: pointer;
    }

    /* === SEARCH SELECT === */
    .select-box {
      position: relative;
    }

    .select-input {
      cursor: pointer;
      background: #fff;
    }

    .options {
      position: absolute;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      background: #fff;
      border-radius: 5px;
      display: none;
      z-index: 10;
    }

    .option {
      padding: 10px;
      cursor: pointer;
    }

    .option:hover {
      background: #1976d2;
      color: #fff;
    }

    .success {
      color: green;
      text-align: center;
      margin-top: 10px;
    }

    .error {
      color: red;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="container">

  <div class="logo">
    <img src="https://raw.githubusercontent.com/cmrito2020-web/cmrito/main/logo%20new%20alpha.png">
  </div>

  <h2>Регистрация участника</h2>

  <form id="regForm">

    <!-- РАЙОН С ПОИСКОМ -->
    <label>Район</label>
    <div class="select-box">
      <input type="text" class="select-input" placeholder="Выберите район" readonly>
      <div class="options" id="districtOptions"></div>
    </div>
    <input type="hidden" name="district" id="districtHidden" required>

    <label>Название учреждения</label>
    <input type="text" name="organization" required>

    <label>ФИО</label>
    <input type="text" name="fio" list="fioList" required placeholder="Начните вводить ФИО">

    <datalist id="fioList">
      <option value="Иванов Иван Иванович">
      <option value="Петров Петр Петрович">
      <option value="Сидорова Анна Сергеевна">
      <option value="Ахметов Нурлан Ерланович">
      <option value="Сарсенова Гульдана Муратовна">
      <option value="Калиев Саят Ерланович">
    </datalist>

    <button type="submit">Отправить</button>
  </form>

  <div id="result"></div>
</div>

<script>
const districts = [
  "Айыртау ауданы",
  "Ақжар ауданы",
  "Аққайың ауданы",
  "Мағжан Жұмабаев ауданы",
  "Есiл ауданы",
  "Жамбыл ауданы",
  "Қызылжар ауданы",
  "Мамлют ауданы",
  "Ғабит Мүсірепов ауданы",
  "Тайынша ауданы",
  "Тимирязев ауданы",
  "Уәлиханов ауданы",
  "Шал ақын ауданы",
  "Петропавл қаласы"
];

const input = document.querySelector(".select-input");
const optionsBox = document.getElementById("districtOptions");
const hidden = document.getElementById("districtHidden");

function renderOptions(filter = "") {
  optionsBox.innerHTML = "";
  districts
    .filter(d => d.toLowerCase().includes(filter.toLowerCase()))
    .forEach(d => {
      const div = document.createElement("div");
      div.className = "option";
      div.textContent = d;
      div.onclick = () => {
        input.value = d;
        hidden.value = d;
        optionsBox.style.display = "none";
      };
      optionsBox.appendChild(div);
    });
}

input.addEventListener("click", () => {
  optionsBox.style.display = "block";
  renderOptions();
});

document.addEventListener("click", e => {
  if (!e.target.closest(".select-box")) {
    optionsBox.style.display = "none";
  }
});

/* === FORM SUBMIT === */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby-SzEGV6nJz-QheTCd-UrldJ23-eF_hsm5oQMwHHMoRxNZa1EFCtL0lMhCeWIFK8Y/exec";

document.getElementById("regForm").addEventListener("submit", function(e) {
  e.preventDefault();

  if (!hidden.value) {
    alert("Выберите район из списка");
    return;
  }

  const formData = new FormData(this);
  const result = document.getElementById("result");

  fetch(SCRIPT_URL, { method: "POST", body: formData })
    .then(r => r.text())
    .then(t => {
      if (t.trim() === "OK") {
        result.innerHTML = "<div class='success'>✅ Успешно отправлено</div>";
        this.reset();
        input.value = "";
      } else {
        result.innerHTML = "<div class='error'>❌ Ошибка: " + t + "</div>";
      }
    })
    .catch(() => result.innerHTML = "<div class='error'>❌ Ошибка соединения</div>");
});
</script>

</body>
</html>
